iimport asyncio
from openai import OpenAI
import os
from playwright.async_api import async_playwright

# üîê –ü–æ–ª—É—á–∞–µ–º API-–∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
client = OpenAI(api_key=os.environ.get("OPENAI_API_KEY"))

# üîó –°—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–π
urls = [
    "https://campus.youfirst.co/fr/residences/residence-etudiante-bordeaux-bassins-a-flot"
]

# üìå –ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–≤—Å—Ç–∞–≤—å —Å–≤–æ–π)
base_prompt = """
–¢—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –æ–ø–∏—Å–∞–Ω–∏–π —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ URL, —á—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ù–µ –Ω–∞—Ä—É—à–∞–π —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞.

üîπ –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
- –ü–∏—à–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.
- –ù–∞–∑–≤–∞–Ω–∏—è —É—á–µ–±–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –∏ —Å—Ç–∞–Ω—Ü–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–π –Ω–∞ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º —è–∑—ã–∫–µ.
- –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–≤–æ ¬´–∫–≤–∞—Ä—Ç–∏—Ä–∞¬ª, –∞ –Ω–µ ¬´–∫–æ–º–Ω–∞—Ç–∞¬ª, –µ—Å–ª–∏ —Ä–µ—á—å –æ–± –æ—Ç–¥–µ–ª—å–Ω–æ–º –∂–∏–ª—å–µ.
- –ù–µ —É–ø–æ–º–∏–Ω–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞. –ó–∞–º–µ–Ω–∏ –Ω–∞ ¬´—Ä–µ–∑–∏–¥–µ–Ω—Ü–∏—è¬ª.
- –ù–ï —É–∫–∞–∑—ã–≤–∞–π –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä (–º¬≤) –≤ —Ç–µ–∫—Å—Ç–µ. –≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –Ω–∞ —Å–∞–π—Ç–µ.
- –ù–ï —É–∫–∞–∑—ã–≤–∞–π –∞–¥—Ä–µ—Å —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ.
- –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Å—ã–ª–æ–∫, –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å–∞–π—Ç–∞. –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç.
- –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã URL. –ù–∏–∫–∞–∫–æ–π –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –æ–±—â–∏–º, –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π –∏–ª–∏ —Å–æ–∫—Ä–∞—Ç–∏, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏—á–µ–≥–æ –æ—Ç —Å–µ–±—è.
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ –¥–µ–ª–∞—Ç—å –ª—é–±—ã–µ –æ–±–æ–±—â–µ–Ω–∏—è, –¥–æ–º—ã—Å–ª—ã, –ª–æ–≥–∏—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã, –¥–æ–ø–æ–ª–Ω—è—Ç—å –∏–ª–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –î–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–∫—Ç –∫–∞–∂–µ—Ç—Å—è –æ—á–µ–≤–∏–¥–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ –µ—Å—Ç—å –∫—É—Ö–Ω—è) ‚Äî –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä—è–º–æ —É–∫–∞–∑–∞–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
- –ü–µ—Ä–µ–≤–æ–¥–∏ –≥—Ä–∞–º–æ—Ç–Ω–æ

üîπ –í–∞–∂–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:
- –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ–∞–∫—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö. –í—Å–µ —Ç—Ä–∏ —á–∞—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏, –Ω–æ –≤–º–µ—Å—Ç–µ –¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ (–≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ –∏ –≤–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω—è—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã).

üîπ –§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–ï–ù):
- –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ø–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏).
–ó–∞–≥–æ–ª–æ–≤–æ–∫: –†–µ–∑–∏–¥–µ–Ω—Ü–∏—è [–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ –Ω–∞ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º] –≤ [–≥–æ—Ä–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–æ–º (–≤ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏, –∫–∞–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏)]

üîπ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—Å—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞):
–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç—Ä–∏ —á–∞—Å—Ç–∏, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (—Å–º. –Ω–∏–∂–µ). –ù–µ –¥–æ–±–∞–≤–ª—è–π –¥—Ä—É–≥–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
–ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
–û —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏
–ü–æ—á–µ–º—É —ç—Ç–∞ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏—è
–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
(–ù–µ –¥–æ–±–∞–≤–ª—è–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äì —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)

üîπ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–ª–∏–Ω–µ —Ç–µ–∫—Å—Ç–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é):
üìå –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –£–î–û–°–¢–û–í–ï–†–¨–°–Ø, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω–æ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏:
–û —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ ‚Äî –æ—Ç 550 –¥–æ 750 —Å–∏–º–≤–æ–ª–æ–≤ (3 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞–±–∑–∞—Ü–∞)
–ü–æ—á–µ–º—É —ç—Ç–∞ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏—è ‚Äî –æ—Ç 500 –¥–æ 650 —Å–∏–º–≤–æ–ª–æ–≤ (2‚Äì3 –∞–±–∑–∞—Ü–∞)
–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ ‚Äî –æ—Ç 500 –¥–æ 650 —Å–∏–º–≤–æ–ª–æ–≤ (2 –∞–±–∑–∞—Ü–∞)

üî∏ –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —ç—Ç–∏ —Ä–∞–º–∫–∏, –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã —É–ª–æ–∂–∏—Ç—å—Å—è –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω. –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ.

üîπ –õ–æ–≥–∏–∫–∞ –∞–±–∑–∞—Ü–µ–≤:
1. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏:
   - 1 –∞–±–∑–∞—Ü: –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤), –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–¥–∏–∑–∞–π–Ω.
   - 2 –∞–±–∑–∞—Ü: –æ—Å–Ω–∞—â–µ–Ω–∏–µ –∏ –º–µ–±–µ–ª—å –≤ –∫–≤–∞—Ä—Ç–∏—Ä–∞—Ö (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–ª–æ—â–∞–¥–∏).
   - 3 –∞–±–∑–∞—Ü: —É—Å–ª—É–≥–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –≤ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏. –ï—Å–ª–∏ –≤ —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏–∏ –µ—Å—Ç—å –∫–æ–≤–æ—Ä–∫–∏–Ω–≥, —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª, –ø—Ä–∞—á–µ—á–Ω–∞—è –∏ –¥—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —ç—Ç–æ —É–∫–∞–∂–∏.
   ‚Äì –ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ –∞—Å–ø–µ–∫—Ç –Ω–µ —É–ø–æ–º—è–Ω—É—Ç –Ω–∞ —Å–∞–π—Ç–µ ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è–π –µ–≥–æ –≤ —Ç–µ–∫—Å—Ç.
–û–±—â–∞—è –¥–ª–∏–Ω–∞ —ç—Ç–æ–π —á–∞—Å—Ç–∏ –æ—Ç 550 –¥–æ 750 —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (3 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞–±–∑–∞—Ü–∞)

2. –ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –≤—ã–±—Ä–∞—Ç—å —ç—Ç—É —Ä–µ–∑–∏–¥–µ–Ω—Ü–∏—é:
   - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è: –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —É—á–µ–±–∞/–¥–æ—Å—É–≥.
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∂–∏–ª—å—Ü–æ–≤.
–û–±—â–∞—è –¥–ª–∏–Ω–∞ —ç—Ç–æ–π —á–∞—Å—Ç–∏ –æ—Ç 500 –¥–æ 650 —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏. –°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π –¥–ª–∏–Ω—É.
"""

async def fetch_text_from_url(url):
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)
        page = await browser.new_page()
        await page.goto(url, timeout=60000)
        text = await page.inner_text("body")
        await browser.close()
        return text

async def process_url(url, index):
    print(f"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é: {url}")
    text = await fetch_text_from_url(url)
    prompt = f"{base_prompt}\n\n–¢–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã:\n{text[:100000]}"
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.4
    )
    output = response.choices[0].message.content
    filename = f"residence_{index + 1}.txt"
    print("\n" + "="*40)
    print(f"–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è {url}:\n")
    print(output)
    print("="*40 + "\n")

async def main():
    for index, url in enumerate(urls):
        try:
            await process_url(url, index)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å {url}: {e}")

asyncio.run(main())
